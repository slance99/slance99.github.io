{
  "hash": "8043d6fdbd2cfcfffa2d0f3a7e894f21",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Predicting Palmetto Species with Binomial Linear Regression\"\nauthor: \"Sam Lance\"\ndate: February 14, 2025\nformat:\n  html:\n    code-fold: true\n    toc: true\n    number-sections: true\n    embed-resources: true\n    theme: Lux\neditor: visual\nexecute:\n  echo: true\n  message: false\n  warning: false\n---\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(ggplot2)\nlibrary(tidyverse)\nlibrary(here)\nlibrary(janitor)\nlibrary(cowplot)\nlibrary(patchwork)\nlibrary(lubridate)\nlibrary(forcats)\nlibrary(stringr)\nlibrary(viridis)\nlibrary(tidymodels)\nlibrary(broom)\nlibrary(kableExtra)\n```\n:::\n\n\n\n\n\n<img src=\"palmetto.jpg\" width=\"700px\"/>\n\n## Overview\n\n[**Data Description**]{.underline}:\n\nThe Palmetto Dataset describes two species of palmetto Serenoa repens and Sabal etonia at the Archbold Biological Station in south-central Florida between 1981-1997 and again in 2001-2017 at five year intervals. The dataset measures many plant features, but this analysis will focus on canopy height, widest canopy length, widest canopy width, and the number of green leaves.\n\n[**Data Source**]{.underline}:\n\nAbrahamson, W.G. 2019. Survival, growth and biomass estimates of two dominant palmetto species of south-central Florida from 1981 - 2017, ongoing at 5-year intervals ver 1. Environmental Data Initiative.\n\n[**Central Questions**]{.underline}:\n\nWhat variables help us to accurately predict whether a palmetto plant is of the species Serenoa repens or Sabal etonia?\n\n[**Psuedocode**]{.underline}:\n\n-   Acquire + Clean Data\n\n-   Perform Exploratory Data Analysis\n\n    -   Create graphs to understand how length, width, height, and \\# green leaves compare between species of palmetto\n\n-   Build + Select Models\n\n    -   Select model variables - length, width, height, \\# of green leaves\n\n    -   Train the model - train the model to understand the data\n\n    -   Model selection - c fold validation to pick which model is best\n\n-   Finalize Model\n\n    -   Train the model on all of the data - allow model to see all of the data\n    -   Test performance - test accuracy, find amount predicted correctly\n\n-   Interpret the Results/ Visualize\n\n## Loading Data\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\npalmetto_og <- read.csv(here(\"posts\",\"2025-03-19-palmetto-244\", \"data\", \"palmetto.csv\")) |>\n  mutate(species = as.factor(species)) \n\npalmetto_clean <- palmetto_og |>\n  mutate(species = ifelse(species %in% c(1, 2), \n                          ifelse(species == 1, \"S. repens\", \"S. etonia\"), col1)) |>\n    select(species, height, width, length, green_lvs)\n```\n:::\n\n\n\n\n\n## Visualizations\n\n### Individual Plots:\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nheight_plot <- palmetto_clean |>\n  ggplot(aes(x=species, y=height, fill=species)) +\n  geom_boxplot() +\n  scale_fill_viridis(discrete = TRUE, alpha=0.6, option = \"G\") +\n  theme_classic() +\n  theme(legend.position=\"none\",\n        plot.title = element_text(size=11),\n        axis.text.x = element_text(size = 10),\n        axis.text.y = element_text(size = 10),\n        axis.title.y = element_text(size = 10)) +\n  labs(x = NULL, y = \"Height (cm)\", title = NULL)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nlength_plot <- palmetto_clean %>%\n  ggplot(aes(x=species, y=length, fill=species)) +\n  geom_boxplot() +\n  scale_fill_viridis(discrete = TRUE, alpha=0.6, option = \"G\") +\n  theme_classic() +\n  theme(legend.position=\"none\",\n        plot.title = element_text(size=11),\n        axis.text.x = element_text(size = 10),\n        axis.text.y = element_text(size = 10),\n        axis.title.y = element_text(size = 10)) +\n  labs(x = NULL, y = \"Length (cm)\", title = NULL)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nwidth_plot <- palmetto_clean %>%\n  ggplot(aes(x=species, y=width, fill=species)) +\n  geom_boxplot() +\n  scale_fill_viridis(discrete = TRUE, alpha=0.6, option = \"G\") +\n  theme_classic() +\n  theme(legend.position=\"none\",\n        plot.title = element_text(size=11),\n        axis.text.x = element_text(size = 10),\n        axis.text.y = element_text(size = 10),\n        axis.title.y = element_text(size = 10)) +\n  labs(x = NULL, y = \"Width (cm)\", title = NULL)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nleaves_plot <- palmetto_clean %>%\n  ggplot(aes(x=species, y=green_lvs, fill=species)) +\n  geom_boxplot() +\n  scale_fill_viridis(discrete = TRUE, alpha=0.6, option = \"G\") +\n  theme_classic() +\n  theme(legend.position=\"none\",\n        plot.title = element_text(size=11),\n        axis.text.x = element_text(size = 10),\n        axis.text.y = element_text(size = 10),\n        axis.title.y = element_text(size = 10)) +\n  labs(x = NULL, y = \"Green Leaves (#)\", title = NULL)\n```\n:::\n\n\n\n\n\n### Cowplots:\n\nBased on the exploratory data analysis conducted, while height and width do not vary much between species, the length and amount of green leaves are visually different.\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndata_vis <- plot_grid(height_plot, width_plot, length_plot, leaves_plot, \n                      labels = c('A', 'B', 'C', 'D'), label_size = 12)\ndata_vis\n```\n\n::: {.cell-output-display}\n![**Figure 1. Comparing Characteristic Measurements of Two Palmetto Species (Serenoa repens and Sabal etonia)**. Plots A and B suggest little difference between height and width between the two species, while plots C and D suggest possible differences between length and the number of green leaves](a2_task1_lance_sam_files/figure-html/unnamed-chunk-7-1.png){width=672}\n:::\n:::\n\n\n\n\n\n## Basic Binary Logistic Regression\n\nThe results of this regression indicate that for model 1 that includes variables height, length, width, and the number of green leaves all possible variables are significant. Model 2, which includes the same variables except length, indicates that only width and green leaves are significant.\n\nComparing the AIC values of each model, model 1 has a smaller AIC value, indicating it better describes the data presented.\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nf1 <- species ~ height + length + width + green_lvs\nf2 <- species ~ height + width + green_lvs\n\nblr_1 <- glm(formula = f1, \n             family = \"binomial\", \n             data = palmetto_og)\n\nblr_2 <- glm(formula = f2, \n             family = \"binomial\", \n             data = palmetto_og)\n```\n:::\n\n\n\n\n\n## Selecting a Model\n\n### Creating + Running Model 1\n\n[**Parameters Included**]{.underline}: Plant height, canopy length, canopy width, and green leaves\n\n[**Results**]{.underline}: This model is 91% accurate, with a ROC value of 97%\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nset.seed(2980)\n\n#splits dataset into 10 folds and repeats 10 times \nfolds_1 <- vfold_cv(palmetto_og, v = 10, repeats = 10)\n\n#creates a regression model \nblr_mdl_1 <- logistic_reg() |>\n  set_engine('glm')\n\n#adds model and formula to the workflow \nblr_wf_1 <- workflow() |>   ### initialize workflow\n  add_model(blr_mdl_1) |>\n  add_formula(formula = f1)\n\n#adds the folds to the workflow and stores the results \nblr_fit_folds_1 <- blr_wf_1 |>\n  fit_resamples(folds_1)\n\n#collect_metrics(blr_fit_folds_1)\n```\n:::\n\n\n\n\n\n### Creating + Running Model 2\n\n[**Parameters Included:**]{.underline} Plant height, canopy width, and green leaves\n\n[**Results**]{.underline}: The model is 89% accurate, with a ROC value of 96%\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nset.seed(2980)\n\nfolds_2 <- vfold_cv(palmetto_og, v = 10, repeats = 10)\n\n\nblr_mdl_2 <- logistic_reg() |>\n  set_engine('glm') ### this is the default - we could try engines from other packages or functions\n\n\nblr_wf_2 <- workflow() |>   ### initialize workflow\n  add_model(blr_mdl_1) |>\n  add_formula(formula = f2)\n\n\nblr_fit_folds_2 <- blr_wf_2 |>\n  fit_resamples(folds_2)\n\n#collect_metrics(blr_fit_folds_2)\n```\n:::\n\n\n\n\n\n### Model Selection\n\nModel 1, which included plant height, canopy length, canopy width, and the amount of green leaves, was chosen for the remainder of this analysis due to its higher accuracy and greater ROC value, both of which indicate better model performance.\n\n## Model Training + Results\n\n### Training Model on All Data\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n#training on the entire dataset \nblr_1_fit <- blr_mdl_1 %>%\n  fit(formula = f1, data = palmetto_og)\n\n#create a column of what the model predicts what species \npalmetto_predict <- palmetto_og %>%\n  mutate(predict(blr_1_fit, new_data = .))\n```\n:::\n\n\n\n\n\n### Model Results\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n#clean up the output of this function \ntidy_palmetto <- tidy(blr_1_fit)\n\nkable(tidy_palmetto, caption = \"Performance Metrics of Model 1\") %>%\n  kable_styling(bootstrap_options = c(\"striped\", \"hover\", \"condensed\"), full_width = F)\n```\n\n::: {.cell-output-display}\n`````{=html}\n<table class=\"table table-striped table-hover table-condensed\" style=\"width: auto !important; margin-left: auto; margin-right: auto;\">\n<caption>Performance Metrics of Model 1</caption>\n <thead>\n  <tr>\n   <th style=\"text-align:left;\"> term </th>\n   <th style=\"text-align:right;\"> estimate </th>\n   <th style=\"text-align:right;\"> std.error </th>\n   <th style=\"text-align:right;\"> statistic </th>\n   <th style=\"text-align:right;\"> p.value </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:left;\"> (Intercept) </td>\n   <td style=\"text-align:right;\"> 3.2266851 </td>\n   <td style=\"text-align:right;\"> 0.1420708 </td>\n   <td style=\"text-align:right;\"> 22.71180 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> height </td>\n   <td style=\"text-align:right;\"> -0.0292173 </td>\n   <td style=\"text-align:right;\"> 0.0023061 </td>\n   <td style=\"text-align:right;\"> -12.66984 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> length </td>\n   <td style=\"text-align:right;\"> 0.0458233 </td>\n   <td style=\"text-align:right;\"> 0.0018661 </td>\n   <td style=\"text-align:right;\"> 24.55600 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> width </td>\n   <td style=\"text-align:right;\"> 0.0394434 </td>\n   <td style=\"text-align:right;\"> 0.0021000 </td>\n   <td style=\"text-align:right;\"> 18.78227 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> green_lvs </td>\n   <td style=\"text-align:right;\"> -1.9084747 </td>\n   <td style=\"text-align:right;\"> 0.0388634 </td>\n   <td style=\"text-align:right;\"> -49.10728 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n  </tr>\n</tbody>\n</table>\n\n`````\n:::\n:::\n\n\n\n\n\n## Success of Model\n\n[**Model Success**]{.underline}: Our model was able to predict the species given palmetto plant by its characteristics (height, length, width, and number of green leaves) between 90% and 92% of the time. This indicates the model has a high predictive accuracy.\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\naccuracy_by_species <- palmetto_predict |>\n  select(species, .pred_class) |> #pick two columns to allow drop_na to work \n  drop_na() |> #drop na to allow the code to work\n  mutate(correct = ifelse(species == .pred_class, 1, 0)) |> \n  group_by(species) |>  #group by actual species\n  summarise(\n    total_cases = n(),  #count total cases per species\n    correct_predictions = sum(correct),  #count the number of correct species predictions \n    incorrect_predictions = total_cases - correct_predictions, #count number of incorrect predictions \n    accuracy = (correct_predictions / total_cases) * 100) #find the accuracy \n\nkable(accuracy_by_species, caption = \"Model 1 Accuracy at Predicting Palmetto Species\") %>%\n  kable_styling(bootstrap_options = c(\"striped\", \"hover\", \"condensed\"), full_width = F)\n```\n\n::: {.cell-output-display}\n`````{=html}\n<table class=\"table table-striped table-hover table-condensed\" style=\"width: auto !important; margin-left: auto; margin-right: auto;\">\n<caption>Model 1 Accuracy at Predicting Palmetto Species</caption>\n <thead>\n  <tr>\n   <th style=\"text-align:left;\"> species </th>\n   <th style=\"text-align:right;\"> total_cases </th>\n   <th style=\"text-align:right;\"> correct_predictions </th>\n   <th style=\"text-align:right;\"> incorrect_predictions </th>\n   <th style=\"text-align:right;\"> accuracy </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:left;\"> 1 </td>\n   <td style=\"text-align:right;\"> 6112 </td>\n   <td style=\"text-align:right;\"> 5548 </td>\n   <td style=\"text-align:right;\"> 564 </td>\n   <td style=\"text-align:right;\"> 90.77225 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> 2 </td>\n   <td style=\"text-align:right;\"> 6155 </td>\n   <td style=\"text-align:right;\"> 5701 </td>\n   <td style=\"text-align:right;\"> 454 </td>\n   <td style=\"text-align:right;\"> 92.62388 </td>\n  </tr>\n</tbody>\n</table>\n\n`````\n:::\n:::\n",
    "supporting": [
      "a2_task1_lance_sam_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<script src=\"../../site_libs/kePrint-0.0.1/kePrint.js\"></script>\n<link href=\"../../site_libs/lightable-0.0.1/lightable.css\" rel=\"stylesheet\" />\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}